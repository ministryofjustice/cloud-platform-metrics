---
apiVersion: v1
kind: ConfigMap
metadata:
  name: aws-metrics-costs
  namespace: monitoring
  labels:
    grafana_dashboard: ""
data:
  dashboard-aws-costs.json: |
    {
      "__inputs": [],
      "__requires": [
        {
          "type": "grafana",
          "id": "grafana",
          "name": "Grafana",
          "version": "5.4.2"
        },
        {
          "type": "panel",
          "id": "graph",
          "name": "Graph",
          "version": "5.0.0"
        },
        {
          "type": "datasource",
          "id": "prometheus",
          "name": "Prometheus",
          "version": "5.0.0"
        },
        {
          "type": "panel",
          "id": "text",
          "name": "Text",
          "version": "5.0.0"
        }
      ],
    {
    	"annotations": {
    		"list": [{
    			"builtIn": 1,
    			"datasource": "-- Grafana --",
    			"enable": true,
    			"hide": true,
    			"iconColor": "rgba(0, 211, 255, 1)",
    			"name": "Annotations & Alerts",
    			"type": "dashboard"
    		}]
    	},
    	"description": "Visualize estimated AWS costs per Namespace/Service",
    	"editable": false,
    	"gnetId": 139,
    	"graphTooltip": 0,
    	"id": null,
    	"iteration": 1614364548685,
    	"links": [],
    	"panels": [{
    			"aliasColors": {},
    			"bars": true,
    			"dashLength": 10,
    			"dashes": false,
    			"datasource": "Thanos",
    			"editable": true,
    			"error": false,
    			"fieldConfig": {
    				"defaults": {
    					"custom": {},
    					"links": []
    				},
    				"overrides": []
    			},
    			"fill": 1,
    			"fillGradient": 0,
    			"grid": {},
    			"gridPos": {
    				"h": 15,
    				"w": 24,
    				"x": 0,
    				"y": 0
    			},
    			"hiddenSeries": false,
    			"id": 1,
    			"isNew": true,
    			"legend": {
    				"alignAsTable": true,
    				"current": true,
    				"hideEmpty": false,
    				"hideZero": false,
    				"show": true,
    				"sort": "current",
    				"sortDesc": true,
    				"total": false,
    				"values": true
    			},
    			"lines": true,
    			"linewidth": 2,
    			"links": [],
    			"nullPointMode": "connected",
    			"options": {
    				"alertThreshold": true
    			},
    			"percentage": false,
    			"pluginVersion": "7.5.9",
    			"pointradius": 5,
    			"points": false,
    			"renderer": "flot",
    			"seriesOverrides": [],
    			"spaceLength": 10,
    			"stack": true,
    			"steppedLine": false,
    			"targets": [{
                                "exemplar": true,
    				"expr": "aws_costs{hosted_ns='$hosted_ns'}"
    				},
    				"expression": "",
    				"functions": [],
    				"group": {
    					"filter": ""
    				},
    				"highResolution": false,
    				"host": {
    					"filter": ""
    				},
    				"id": "",
    				"item": {
    					"filter": ""
    				},
    				"matchExact": true,
    				"metricName": "AWS Service Costs $hosted_ns",
    				"mode": 0,
    				"namespace": "monitoring",
    				"options": {
    					"showDisabledItems": false
    				},
    				"period": "",
    				"refId": "A",
    				"returnData": false
    				]
    			}],
    			"thresholds": [],
    			"timeFrom": null,
    			"timeRegions": [],
    			"timeShift": null,
    			"title": "AWS Service Costs $hosted_ns",
    			"tooltip": {
    				"msResolution": false,
    				"shared": true,
    				"sort": 2,
    				"value_type": "cumulative"
    			},
    			"type": "graph",
    			"xaxis": {
    				"buckets": null,
    				"mode": "time",
    				"name": null,
    				"show": true,
    				"values": []
    			},
    			"yaxes": [{
    					"format": "currencyGBP",
    					"label": null,
    					"logBase": 1,
    					"show": true
    				},
    				{
    					"format": "short",
    					"label": null,
    					"logBase": 1,
    					"show": false
    				}
    			],
    			"yaxis": {
    				"align": false,
    				"alignLevel": null
    			}
    		},
    		{
    			"aliasColors": {},
    			"bars": true,
    			"dashLength": 10,
    			"dashes": false,
    			"datasource": "Thanos",
    			"editable": true,
    			"error": false,
    			"fieldConfig": {
    				"defaults": {
    					"custom": {},
    					"links": []
    				},
    				"overrides": []
    			},
    			"fill": 1,
    			"fillGradient": 0,
    			"grid": {},
    			"gridPos": {
    				"h": 15,
    				"w": 24,
    				"x": 0,
    				"y": 0
    			},
    			"hiddenSeries": false,
    			"id": 1,
    			"isNew": true,
    			"legend": {
    				"alignAsTable": true,
    				"current": true,
    				"hideEmpty": false,
    				"hideZero": false,
    				"show": true,
    				"sort": "current",
    				"sortDesc": true,
    				"total": false,
    				"values": true
    			},
    			"lines": true,
    			"linewidth": 2,
    			"links": [],
    			"nullPointMode": "connected",
    			"options": {
    				"alertThreshold": true
    			},
    			"percentage": false,
    			"pluginVersion": "7.5.9",
    			"pointradius": 5,
    			"points": false,
    			"renderer": "flot",
    			"seriesOverrides": [],
    			"spaceLength": 10,
    			"stack": false,
    			"steppedLine": false,
    			"targets": [{
                                        "exemplar": true,
    					"expr": "sum (aws_costs{hosted_ns='$hosted_ns'})"
    					},
    					"expression": "",
    					"functions": [],
    					"group": {
    						"filter": ""
    					},
    					"highResolution": false,
    					"host": {
    						"filter": ""
    					},
    					"id": "",
    					"item": {
    						"filter": ""
    					},
    					"matchExact": true,
    					"metricName": "AWS Namespace Costs $hosted_ns",
    					"mode": 0,
    					"namespace": "monitoring",
    					"options": {
    						"showDisabledItems": false
    					},
    					"period": "",
    					"refId": "A",
    					"returnData": false
    					]
    				},
    				{
    					"expression": "",
    					"functions": [],
    					"group": {
    						"filter": ""
    					},
    					"highResolution": false,
    					"host": {
    						"filter": ""
    					},
    					"id": "",
    					"item": {
    						"filter": ""
    					},
    					"matchExact": true,
    					"metricName": "AWS Namespace Costs $hosted_ns",
    					"mode": 0,
    					"namespace": "monitoring",
    					"options": {
    						"showDisabledItems": false
    					},
    					"period": "",
    					"refId": "B",
    					"returnData": false
    					]
    				}
    			],
    			"thresholds": [],
    			"timeFrom": null,
    			"timeRegions": [],
    			"timeShift": null,
    			"title": "AWS Namespace Costs $hosted_ns",
    			"tooltip": {
    				"msResolution": false,
    				"shared": true,
    				"sort": 2,
    				"value_type": "cumulative"
    			},
    			"type": "graph",
    			"xaxis": {
    				"buckets": null,
    				"mode": "time",
    				"name": null,
    				"show": true,
    				"values": []
    			},
    			"yaxes": [{
    					"format": "currencyGBP",
    					"label": null,
    					"logBase": 1,
    					"show": true
    				},
    				{
    					"format": "short",
    					"label": null,
    					"logBase": 1,
    					"show": false
    				}
    			],
    			"yaxis": {
    				"align": false,
    				"alignLevel": null
    			}
    		},
    		{
    			"aliasColors": {},
    			"bars": true,
    			"dashLength": 10,
    			"dashes": false,
    			"datasource": "Thanos",
    			"editable": true,
    			"error": false,
    			"fieldConfig": {
    				"defaults": {
    					"custom": {},
    					"links": []
    				},
    				"overrides": []
    			},
    			"fill": 1,
    			"fillGradient": 0,
    			"grid": {},
    			"gridPos": {
    				"h": 10,
    				"w": 24,
    				"x": 0,
    				"y": 15
    			},
    			"hiddenSeries": false,
    			"id": 3,
    			"isNew": true,
    			"legend": {
    				"alignAsTable": true,
    				"current": true,
    				"hideEmpty": false,
    				"hideZero": false,
    				"show": true,
    				"sort": "current",
    				"sortDesc": true,
    				"total": false,
    				"values": true
    			},
    			"lines": false,
    			"linewidth": 2,
    			"links": [],
    			"nullPointMode": "connected",
    			"options": {
    				"alertThreshold": true
    			},
    			"percentage": false,
    			"pluginVersion": "7.5.9",
    			"pointradius": 5,
    			"points": false,
    			"renderer": "flot",
    			"seriesOverrides": [],
    			"spaceLength": 10,
    			"stack": true,
    			"steppedLine": false,
    			"targets": [{
                                        "exemplar": true,
    					"expr": "sum (aws_costs) by (hosted_ns)"
    					},
    					"expression": "",
    					"functions": [],
    					"group": {
    						"filter": ""
    					},
    					"highResolution": false,
    					"host": {
    						"filter": ""
    					},
    					"id": "",
    					"item": {
    						"filter": ""
    					},
    					"matchExact": true,
    					"metricName": "AWS Namespace Costs All Namespaces",
    					"mode": 0,
    					"namespace": "monitoring",
    					"options": {
    						"showDisabledItems": false
    					},
    					"period": "",
    					"refId": "A",
    					"returnData": false
    					]
    				},
    				{
    					"expression": "",
    					"functions": [],
    					"group": {
    						"filter": ""
    					},
    					"highResolution": false,
    					"host": {
    						"filter": ""
    					},
    					"id": "",
    					"item": {
    						"filter": ""
    					},
    					"matchExact": true,
    					"metricName": "AWS Namespace Costs All Namespaces",
    					"mode": 0,
    					"namespace": "monitoring",
    					"options": {
    						"showDisabledItems": false
    					},
    					"period": "",
    					"refId": "B",
    					"returnData": false
    					]
    				}
    			],
    			"thresholds": [],
    			"timeFrom": null,
    			"timeRegions": [],
    			"timeShift": null,
    			"title": "AWS Namespace Costs All Namespaces",
    			"tooltip": {
    				"msResolution": false,
    				"shared": true,
    				"sort": 2,
    				"value_type": "cumulative"
    			},
    			"type": "graph",
    			"xaxis": {
    				"buckets": null,
    				"mode": "time",
    				"name": null,
    				"show": true,
    				"values": []
    			},
    			"yaxes": [{
    					"$$hashKey": "object:75",
    					"format": "currencyGBP",
    					"label": null,
    					"logBase": 1,
    					"show": true
    				},
    				{
    					"$$hashKey": "object:76",
    					"format": "short",
    					"label": null,
    					"logBase": 1,
    					"show": false
    				}
    			],
    			"yaxis": {
    				"align": false,
    				"alignLevel": null
    			}
    		},
    		{
    			"datasource": "Thanos",
    			"editable": true,
    			"error": false,
    			"fieldConfig": {
    				"defaults": {
    					"custom": {}
    				},
    				"overrides": []
    			},
    			"gridPos": {
    				"h": 3,
    				"w": 24,
    				"x": 0,
    				"y": 25
    			},
    			"id": 2,
    			"isNew": true,
    			"links": [],
    			"options": []


    		}
    	],
    	"refresh": false,
    	"schemaVersion": 27,
    	"style": "dark",
    	"tags": [
    		"metrics",
    		"monitoring"
    	],
    	"templating": {
    		"list": [{
    			"allValue": null,
    			"current": {
    				"selected": true,
    				"text": "manage-recalls-prod",
    				"value": "manage-recalls-prod"
    			},
    			"datasource": "Thanos",
    			"definition": "label_values(aws_costs{}, hosted_ns)",
    			"description": null,
    			"error": null,
    			"hide": 0,
    			"includeAll": false,
    			"label": null,
    			"multi": false,
    			"name": "hosted_ns",
    			"options": [],
    			"query": {
    				"query": "label_values(aws_costs{}, hosted_ns)",
    				"refId": "StandardVariableQuery"
    			},
    			"refresh": 1,
    			"regex": "",
    			"skipUrlSync": false,
    			"sort": 1,
    			"tagValuesQuery": "",
    			"tags": [],
    			"tagsQuery": "",
    			"type": "query",
    			"useTags": false
    		}]
    	},
    	"time": {
    		"from": "now-1h",
    		"to": "now"
    	},
    	"timepicker": {
    		"refresh_intervals": [
    			"5s",
    			"10s",
    			"30s",
    			"1m",
    			"5m",
    			"15m",
    			"30m",
    			"1h",
    			"2h",
    			"1d"
    		],
    		"time_options": [
    			"5m",
    			"15m",
    			"1h",
    			"6h",
    			"12h",
    			"24h",
    			"2d",
    			"7d",
    			"30d"
    		]
    	},
    	"timezone": "browser",
    	"title": "AWS_Costs",
    	"uid": "aws_costs",
    	"version": 1
    }
